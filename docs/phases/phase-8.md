# Фаза 8: Интеграция AI с системой метаданных

Данный документ содержит предварительное планирование задач для интеграции искусственного интеллекта с системой метаданных компонентов.

**Статус**: 🔄 В процессе

---

## Обзор

**Цель**: Интегрировать AI в систему метаданных для интерактивного взаимодействия с режимом разработки.

**Проблема**: Текущая система метаданных (Developer Mode) предоставляет статическую информацию о компонентах. Разработчикам требуется возможность:
- Задавать вопросы о компонентах на естественном языке
- Получать контекстную помощь в режиме разработки
- Быстро находить нужные компоненты и их функциональность

**Решение**: AI-ассистент в DevMode, который:
- Понимает запросы на естественном языке
- Использует метаданные компонентов для ответов
- Предлагает контекстуальные подсказки
- Помогает в навигации по кодовой базе

**Основные требования**:
- Интеграция AI с существующим DevMode контекстом
- Естественно-языковой интерфейс для запросов
- Поиск и анализ компонентов по метаданным
- Интерактивная панель для взаимодействия с AI

---

## Планируемые TASK

### TASK 49: AI Query Interface для DevMode ✅ Завершено

**Заголовок**: `Создание интерфейса для AI-запросов в режиме разработки`

**Описание**:
Создать UI-компонент для ввода запросов к AI в режиме разработки и отображения ответов.

**Планируемые задачи**:
- [x] Создание компонента DevModeQueryPanel
- [x] Поле ввода для естественно-языковых запросов
- [x] Область отображения ответов с форматированием
- [x] История запросов с возможностью повторного использования
- [x] Интеграция с DevMode контекстом

**Критерии приёмки**:
- ✅ Пользователь может вводить запросы на естественном языке
- ✅ Ответы отображаются в удобном формате
- ✅ История запросов сохраняется в сессии (localStorage)
- ✅ Панель можно свернуть/развернуть
- ✅ Поддержка клавиатурного сокращения для быстрого доступа (Ctrl+Shift+Q)

**Реализовано**:
- `src/types/ai-query.ts` — Типы для AI-запросов (AIQueryRequest, AIQueryResponse, QueryIntent, QueryHistoryEntry и др.)
- `src/types/ai-query.test.ts` — Тесты для типов AI-запросов
- `src/components/DevModeQueryPanel.tsx` — UI-компонент для AI-запросов в DevMode
- `src/components/DevModeQueryPanel.test.tsx` — Тесты для DevModeQueryPanel

**Особенности реализации**:
- Поддержка русского и английского языков (автоопределение)
- Классификация намерений (describe, find, dependencies, history, usage, related, features, status)
- Примеры запросов для быстрого старта
- Отображение найденных компонентов
- Предложения для уточнения запроса
- Индикатор уверенности ответа
- Персистентная история в localStorage

**Метки**: `ai`, `devmode`, `ui`, `query`

---

### TASK 50: AI Metadata Processor ✅ Завершено

**Заголовок**: `Обработчик метаданных для AI-запросов`

**Описание**:
Создать модуль для обработки метаданных компонентов и генерации ответов на запросы.

**Планируемые задачи**:
- [x] Создание модуля ai-metadata-processor.ts
- [x] Индексация всех метаданных компонентов
- [x] Парсинг естественно-языковых запросов
- [x] Семантический поиск по метаданным
- [x] Формирование структурированных ответов

**Критерии приёмки**:
- ✅ Модуль индексирует все зарегистрированные компоненты
- ✅ Парсинг запросов извлекает ключевые слова и интенты
- ✅ Семантический поиск находит релевантные компоненты
- ✅ Ответы содержат полезную информацию о компонентах
- ✅ Поддержка запросов на русском и английском языках

**Реализовано**:
- `src/lib/ai-metadata-processor.ts` — Основной модуль обработки метаданных
- `src/lib/ai-metadata-processor.test.ts` — Тесты для модуля (77 тестов)

**Особенности реализации**:
- Класс `AIMetadataProcessor` с конфигурируемыми параметрами
- Индексация метаданных с токенизацией и нормализацией
- Поддержка всех интентов: describe, find, dependencies, history, usage, related, features, status
- Семантический поиск с оценкой релевантности (TF-IDF стиль)
- Кеширование результатов с настраиваемым TTL
- Перевод русских ключевых слов для улучшения поиска
- Фильтрация по фазе, статусу, тегам
- Генерация структурированных ответов на русском и английском языках
- Экспортируемые функции для удобного использования:
  - `processMetadataQuery()` — обработка запроса
  - `parseMetadataQuery()` — парсинг запроса
  - `searchMetadata()` — поиск по метаданным
  - `refreshMetadataIndex()` — обновление индекса
  - `getDefaultProcessor()` — получение singleton процессора

**Метки**: `ai`, `metadata`, `search`, `nlp`

---

### TASK 51: Component Context Assistant

**Заголовок**: `AI-ассистент для контекстной информации о компоненте`

**Описание**:
Реализовать AI-ассистента, который предоставляет информацию о выбранном компоненте.

**Планируемые задачи**:
- [ ] Определение выбранного/активного компонента
- [ ] Контекстная панель с AI-информацией
- [ ] Генерация описания компонента
- [ ] Предложение связанных компонентов
- [ ] Подсказки по использованию

**Критерии приёмки**:
- При выборе компонента появляется контекстная информация
- AI генерирует понятное описание функциональности
- Показываются связанные компоненты и зависимости
- Предлагаются подсказки по использованию
- Информация обновляется при смене выбранного компонента

**Метки**: `ai`, `context`, `assistant`, `devmode`

---

### TASK 52: Расширенный поиск компонентов

**Заголовок**: `AI-поиск компонентов по описанию функциональности`

**Описание**:
Расширить функционал поиска компонентов с использованием AI для понимания намерений.

**Планируемые задачи**:
- [ ] Семантический поиск по описаниям
- [ ] Поиск по функциональности ("найди компонент для...")
- [ ] Фильтрация по фазам, статусу, тегам
- [ ] Автодополнение запросов
- [ ] Ранжирование результатов по релевантности

**Критерии приёмки**:
- Поиск понимает описания функциональности
- Автодополнение помогает сформулировать запрос
- Результаты ранжируются по релевантности
- Поддержка сложных запросов с фильтрами
- Быстрая работа даже с большим количеством компонентов

**Метки**: `ai`, `search`, `components`, `ux`

---

### TASK 53: Интеграция с TinyLLM

**Заголовок**: `Расширение TinyLLM для работы с метаданными`

**Описание**:
Расширить существующий модуль TinyLLM для обработки запросов о метаданных.

**Планируемые задачи**:
- [ ] Добавление режима "metadata query" в TinyLLM
- [ ] Обучение на примерах запросов о компонентах
- [ ] Интеграция с componentMetaRegistry
- [ ] Кеширование частых запросов
- [ ] Fallback на rule-based обработку

**Критерии приёмки**:
- TinyLLM обрабатывает запросы о метаданных
- Ответы генерируются на основе реальных данных
- Кеширование ускоряет повторные запросы
- Rule-based fallback работает при сбоях AI
- Работает offline (client-side)

**Метки**: `ai`, `tinyLLM`, `integration`, `metadata`

---

## Архитектура

### Схема взаимодействия

```
┌─────────────────────────────────────────────────────────────┐
│                     DevMode Context                          │
│  ┌─────────────────────────────────────────────────────────┐│
│  │                 DevModeQueryPanel                        ││
│  │  ┌─────────────────────┐  ┌──────────────────────────┐ ││
│  │  │  Query Input Field  │→→│   AI Response Display    │ ││
│  │  └─────────────────────┘  └──────────────────────────┘ ││
│  └─────────────────────────────────────────────────────────┘│
└───────────────────────────┬─────────────────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────────┐
│                   AI Metadata Processor                      │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────┐ │
│  │  Query Parser   │→→│ Semantic Search │→→│  Response   │ │
│  │  (NLP Intent)   │  │ (Metadata Index)│  │  Generator  │ │
│  └─────────────────┘  └─────────────────┘  └─────────────┘ │
└───────────────────────────┬─────────────────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────────┐
│                  TinyLLM + Metadata Registry                 │
│  ┌─────────────────────┐      ┌────────────────────────┐   │
│  │   TinyLLM Engine    │      │ componentMetaRegistry  │   │
│  │  (NL Processing)    │◄────►│   (All Components)     │   │
│  └─────────────────────┘      └────────────────────────┘   │
└─────────────────────────────────────────────────────────────┘
```

### Примеры запросов

1. **Базовые запросы**:
   - "Что делает компонент Gallery?"
   - "Какие зависимости у UnifiedEditor?"
   - "Покажи историю изменений CubePreview"

2. **Поиск по функциональности**:
   - "Найди компонент для экспорта кубиков"
   - "Какой компонент отвечает за 3D рендеринг?"
   - "Где реализована система шаринга?"

3. **Контекстные запросы**:
   - "Как использовать этот компонент?"
   - "Какие компоненты связаны с текущим?"
   - "Есть ли известные проблемы?"

### Типы данных

```typescript
interface AIQueryRequest {
  query: string;           // Текст запроса
  context?: string;        // Контекст (ID текущего компонента)
  language: 'ru' | 'en';   // Язык запроса
  intent?: QueryIntent;    // Определённое намерение
}

interface AIQueryResponse {
  success: boolean;
  answer: string;                    // Основной ответ
  components?: ComponentMeta[];      // Найденные компоненты
  suggestions?: string[];            // Предложения для уточнения
  relatedQueries?: string[];         // Связанные запросы
  confidence: number;                // Уверенность в ответе
}

type QueryIntent =
  | 'describe'        // Описать компонент
  | 'find'            // Найти компонент
  | 'dependencies'    // Показать зависимости
  | 'history'         // Показать историю
  | 'usage'           // Как использовать
  | 'related';        // Связанные компоненты
```

---

## Оценка объёма работ

| TASK | Сложность | Приоритет | Статус |
|------|-----------|-----------|--------|
| 49. AI Query Interface | Средняя | Критический | ✅ Завершено |
| 50. AI Metadata Processor | Высокая | Критический | ✅ Завершено |
| 51. Component Context Assistant | Средняя | Высокий | Планируется |
| 52. Расширенный поиск | Средняя | Средний | Планируется |
| 53. Интеграция с TinyLLM | Высокая | Критический | Планируется |

---

## Зависимости

- **Фаза 6** (Developer Experience) — система метаданных и DevMode контекст
- **TinyLLM** — существующий AI-модуль для генерации
- **componentMetaRegistry** — реестр метаданных компонентов

---

## Следующие шаги

После завершения Фазы 8 планируется:

- **Фаза 9**: Marketplace и монетизация
  - Платные кубики и пресеты
  - Премиум-подписка
  - Выплаты авторам

---

**Назад к [README](../../README.md)**
