# Фаза 8: Интеграция AI с системой метаданных

Данный документ содержит предварительное планирование задач для интеграции искусственного интеллекта с системой метаданных компонентов.

**Статус**: ✅ Завершено

---

## Обзор

**Цель**: Интегрировать AI в систему метаданных для интерактивного взаимодействия с режимом разработки.

**Проблема**: Текущая система метаданных (Developer Mode) предоставляет статическую информацию о компонентах. Разработчикам требуется возможность:
- Задавать вопросы о компонентах на естественном языке
- Получать контекстную помощь в режиме разработки
- Быстро находить нужные компоненты и их функциональность

**Решение**: AI-ассистент в DevMode, который:
- Понимает запросы на естественном языке
- Использует метаданные компонентов для ответов
- Предлагает контекстуальные подсказки
- Помогает в навигации по кодовой базе

**Основные требования**:
- Интеграция AI с существующим DevMode контекстом
- Естественно-языковой интерфейс для запросов
- Поиск и анализ компонентов по метаданным
- Интерактивная панель для взаимодействия с AI

---

## Планируемые TASK

### TASK 49: AI Query Interface для DevMode ✅ Завершено

**Заголовок**: `Создание интерфейса для AI-запросов в режиме разработки`

**Описание**:
Создать UI-компонент для ввода запросов к AI в режиме разработки и отображения ответов.

**Планируемые задачи**:
- [x] Создание компонента DevModeQueryPanel
- [x] Поле ввода для естественно-языковых запросов
- [x] Область отображения ответов с форматированием
- [x] История запросов с возможностью повторного использования
- [x] Интеграция с DevMode контекстом

**Критерии приёмки**:
- ✅ Пользователь может вводить запросы на естественном языке
- ✅ Ответы отображаются в удобном формате
- ✅ История запросов сохраняется в сессии (localStorage)
- ✅ Панель можно свернуть/развернуть
- ✅ Поддержка клавиатурного сокращения для быстрого доступа (Ctrl+Shift+Q)

**Реализовано**:
- `src/types/ai-query.ts` — Типы для AI-запросов (AIQueryRequest, AIQueryResponse, QueryIntent, QueryHistoryEntry и др.)
- `src/types/ai-query.test.ts` — Тесты для типов AI-запросов
- `src/components/DevModeQueryPanel.tsx` — UI-компонент для AI-запросов в DevMode
- `src/components/DevModeQueryPanel.test.tsx` — Тесты для DevModeQueryPanel

**Особенности реализации**:
- Поддержка русского и английского языков (автоопределение)
- Классификация намерений (describe, find, dependencies, history, usage, related, features, status)
- Примеры запросов для быстрого старта
- Отображение найденных компонентов
- Предложения для уточнения запроса
- Индикатор уверенности ответа
- Персистентная история в localStorage

**Метки**: `ai`, `devmode`, `ui`, `query`

---

### TASK 50: AI Metadata Processor ✅ Завершено

**Заголовок**: `Обработчик метаданных для AI-запросов`

**Описание**:
Создать модуль для обработки метаданных компонентов и генерации ответов на запросы.

**Планируемые задачи**:
- [x] Создание модуля ai-metadata-processor.ts
- [x] Индексация всех метаданных компонентов
- [x] Парсинг естественно-языковых запросов
- [x] Семантический поиск по метаданным
- [x] Формирование структурированных ответов

**Критерии приёмки**:
- ✅ Модуль индексирует все зарегистрированные компоненты
- ✅ Парсинг запросов извлекает ключевые слова и интенты
- ✅ Семантический поиск находит релевантные компоненты
- ✅ Ответы содержат полезную информацию о компонентах
- ✅ Поддержка запросов на русском и английском языках

**Реализовано**:
- `src/lib/ai-metadata-processor.ts` — Основной модуль обработки метаданных
- `src/lib/ai-metadata-processor.test.ts` — Тесты для модуля (77 тестов)

**Особенности реализации**:
- Класс `AIMetadataProcessor` с конфигурируемыми параметрами
- Индексация метаданных с токенизацией и нормализацией
- Поддержка всех интентов: describe, find, dependencies, history, usage, related, features, status
- Семантический поиск с оценкой релевантности (TF-IDF стиль)
- Кеширование результатов с настраиваемым TTL
- Перевод русских ключевых слов для улучшения поиска
- Фильтрация по фазе, статусу, тегам
- Генерация структурированных ответов на русском и английском языках
- Экспортируемые функции для удобного использования:
  - `processMetadataQuery()` — обработка запроса
  - `parseMetadataQuery()` — парсинг запроса
  - `searchMetadata()` — поиск по метаданным
  - `refreshMetadataIndex()` — обновление индекса
  - `getDefaultProcessor()` — получение singleton процессора

**Метки**: `ai`, `metadata`, `search`, `nlp`

---

### TASK 51: Component Context Assistant ✅ Завершено

**Заголовок**: `AI-ассистент для контекстной информации о компоненте`

**Описание**:
Реализовать AI-ассистента, который предоставляет информацию о выбранном компоненте.

**Планируемые задачи**:
- [x] Определение выбранного/активного компонента
- [x] Контекстная панель с AI-информацией
- [x] Генерация описания компонента
- [x] Предложение связанных компонентов
- [x] Подсказки по использованию

**Критерии приёмки**:
- ✅ При выборе компонента появляется контекстная информация
- ✅ AI генерирует понятное описание функциональности
- ✅ Показываются связанные компоненты и зависимости
- ✅ Предлагаются подсказки по использованию
- ✅ Информация обновляется при смене выбранного компонента

**Реализовано**:
- `src/types/ai-query.ts` — Расширенные типы для контекстного ассистента (ComponentContextInfo, RelatedComponentInfo, ContextPanelSettings)
- `src/types/ai-query.test.ts` — Тесты для новых типов контекстного ассистента
- `src/components/ComponentContextPanel.tsx` — UI-компонент контекстной панели
- `src/components/ComponentContextPanel.test.tsx` — Тесты для ComponentContextPanel (41 тест)

**Особенности реализации**:
- Поддержка русского и английского языков
- Автоматическое обновление при смене выбранного компонента
- Генерация описания на основе метаданных компонента
- Отображение связанных компонентов (зависимости, зависимые, похожие)
- Подсказки по использованию из метаданных
- Паттерны использования (import, JSX)
- Индикатор уверенности
- Настраиваемая позиция панели (top-left, top-right, bottom-left, bottom-right)
- Сворачиваемая/разворачиваемая панель
- Сохранение настроек в localStorage
- Экспортируемые утилиты:
  - `generateContextInfo()` — генерация контекста
  - `generateDescription()` — генерация описания
  - `findRelatedComponents()` — поиск связанных компонентов
  - `generatePatterns()` — генерация паттернов использования
  - `calculateConfidence()` — расчёт уверенности

**Метки**: `ai`, `context`, `assistant`, `devmode`

---

### TASK 52: Расширенный поиск компонентов ✅ Завершено

**Заголовок**: `AI-поиск компонентов по описанию функциональности`

**Описание**:
Расширить функционал поиска компонентов с использованием AI для понимания намерений.

**Планируемые задачи**:
- [x] Семантический поиск по описаниям
- [x] Поиск по функциональности ("найди компонент для...")
- [x] Фильтрация по фазам, статусу, тегам
- [x] Автодополнение запросов
- [x] Ранжирование результатов по релевантности

**Критерии приёмки**:
- ✅ Поиск понимает описания функциональности
- ✅ Автодополнение помогает сформулировать запрос
- ✅ Результаты ранжируются по релевантности
- ✅ Поддержка сложных запросов с фильтрами
- ✅ Быстрая работа даже с большим количеством компонентов

**Реализовано**:
- `src/lib/extended-search.ts` — Основной модуль расширенного поиска
- `src/lib/extended-search.test.ts` — Тесты для модуля (100+ тестов)
- `src/components/ExtendedSearchPanel.tsx` — UI-компонент расширенного поиска
- `src/components/ExtendedSearchPanel.test.tsx` — Тесты для компонента

**Особенности реализации**:
- **Семантический поиск**: Токенизация и индексирование всех компонентов с поддержкой русского и английского языков
- **Поиск по функциональности**: Паттерны для определения функциональности (export, preview, edit, generate, share, collaborate, stack)
- **Фильтрация**: По фазам, статусу (stable, beta, experimental), тегам (OR и AND логика)
- **Автодополнение**: Предложения компонентов, тегов, фич, фраз и фильтров при вводе
- **Ранжирование**: TF-IDF стиль с весами полей (name: 35%, summary: 25%, description: 20%, tags: 10%, features: 10%)
- **Fuzzy matching**: Поддержка нечёткого поиска с настраиваемым порогом (Levenshtein distance)
- **Inline фильтры**: Поддержка синтаксиса `phase:1`, `status:stable`, `#tag` в запросах
- **Подсветка**: Выделение совпавших терминов в результатах
- **Перевод терминов**: Автоматический перевод русских терминов в английские для улучшения поиска
- **Клавиатурный shortcut**: `Ctrl+Shift+F` для быстрого доступа к панели

**Экспортируемые функции**:
- `extendedSearch()` — поиск компонентов
- `searchByFunctionality()` — поиск по описанию функциональности
- `getAutocompleteSuggestions()` — получение автодополнений
- `refreshSearchIndex()` — обновление индекса
- `getDefaultSearchEngine()` — получение singleton движка поиска

**Метки**: `ai`, `search`, `components`, `ux`

---

### TASK 53: Интеграция с TinyLLM ✅ Завершено

**Заголовок**: `Расширение TinyLLM для работы с метаданными`

**Описание**:
Расширить существующий модуль TinyLLM для обработки запросов о метаданных.

**Планируемые задачи**:
- [x] Добавление режима "metadata query" в TinyLLM
- [x] Обучение на примерах запросов о компонентах
- [x] Интеграция с componentMetaRegistry
- [x] Кеширование частых запросов
- [x] Fallback на rule-based обработку

**Критерии приёмки**:
- ✅ TinyLLM обрабатывает запросы о метаданных
- ✅ Ответы генерируются на основе реальных данных
- ✅ Кеширование ускоряет повторные запросы
- ✅ Rule-based fallback работает при сбоях AI
- ✅ Работает offline (client-side)

**Реализовано**:
- `src/lib/tinyLLM.ts` — Расширен модуль TinyLLM для работы с метаданными компонентов (~700 строк нового кода)
- `src/lib/tinyLLM.test.ts` — Тесты для новой функциональности (~40 новых тестов)

**Особенности реализации**:
- **Режим metadata query**: Новый режим обработки запросов о метаданных компонентов
- **Интеграция с registry**: Использует `searchComponentMeta()` и `getAllComponentMeta()` из componentMetaRegistry
- **Кеширование**: Map-based кеш с настраиваемым TTL (по умолчанию 300 секунд)
- **Rule-based fallback**: Автоматический fallback при сбоях AI-обработки
- **Двуязычная поддержка**: Русский и английский языки
- **Классификация интентов**: describe, find, dependencies, history, usage, related, features, status
- **Датасет для обучения**: Система управления примерами запросов с возможностью экспорта/импорта
- **Обратная связь**: Запись feedback для улучшения модели

**Экспортируемые функции**:
- `isMetadataQueryReady()` — проверка готовности режима metadata query
- `initializeMetadataQueryMode()` — инициализация режима
- `processMetadataQueryWithLLM()` — обработка запроса через LLM
- `clearMetadataQueryCache()` — очистка кеша
- `setMetadataQueryConfig()` / `getMetadataQueryConfig()` — настройка режима
- `addMetadataQueryTrainingExample()` — добавление примера в датасет
- `getMetadataQueryDataset()` / `clearMetadataQueryDataset()` — управление датасетом
- `loadMetadataQueryDataset()` / `exportMetadataQueryDataset()` — импорт/экспорт датасета
- `recordMetadataQueryFeedback()` — запись обратной связи
- `getAvailableMetadataQueryIntents()` — список доступных интентов
- `getMetadataQueryExamples()` — примеры запросов

**Метки**: `ai`, `tinyLLM`, `integration`, `metadata`

---

## Архитектура

### Схема взаимодействия

```
┌─────────────────────────────────────────────────────────────┐
│                     DevMode Context                          │
│  ┌─────────────────────────────────────────────────────────┐│
│  │                 DevModeQueryPanel                        ││
│  │  ┌─────────────────────┐  ┌──────────────────────────┐ ││
│  │  │  Query Input Field  │→→│   AI Response Display    │ ││
│  │  └─────────────────────┘  └──────────────────────────┘ ││
│  └─────────────────────────────────────────────────────────┘│
└───────────────────────────┬─────────────────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────────┐
│                   AI Metadata Processor                      │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────┐ │
│  │  Query Parser   │→→│ Semantic Search │→→│  Response   │ │
│  │  (NLP Intent)   │  │ (Metadata Index)│  │  Generator  │ │
│  └─────────────────┘  └─────────────────┘  └─────────────┘ │
└───────────────────────────┬─────────────────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────────┐
│                  TinyLLM + Metadata Registry                 │
│  ┌─────────────────────┐      ┌────────────────────────┐   │
│  │   TinyLLM Engine    │      │ componentMetaRegistry  │   │
│  │  (NL Processing)    │◄────►│   (All Components)     │   │
│  └─────────────────────┘      └────────────────────────┘   │
└─────────────────────────────────────────────────────────────┘
```

### Примеры запросов

1. **Базовые запросы**:
   - "Что делает компонент Gallery?"
   - "Какие зависимости у UnifiedEditor?"
   - "Покажи историю изменений CubePreview"

2. **Поиск по функциональности**:
   - "Найди компонент для экспорта кубиков"
   - "Какой компонент отвечает за 3D рендеринг?"
   - "Где реализована система шаринга?"

3. **Контекстные запросы**:
   - "Как использовать этот компонент?"
   - "Какие компоненты связаны с текущим?"
   - "Есть ли известные проблемы?"

### Типы данных

```typescript
interface AIQueryRequest {
  query: string;           // Текст запроса
  context?: string;        // Контекст (ID текущего компонента)
  language: 'ru' | 'en';   // Язык запроса
  intent?: QueryIntent;    // Определённое намерение
}

interface AIQueryResponse {
  success: boolean;
  answer: string;                    // Основной ответ
  components?: ComponentMeta[];      // Найденные компоненты
  suggestions?: string[];            // Предложения для уточнения
  relatedQueries?: string[];         // Связанные запросы
  confidence: number;                // Уверенность в ответе
}

type QueryIntent =
  | 'describe'        // Описать компонент
  | 'find'            // Найти компонент
  | 'dependencies'    // Показать зависимости
  | 'history'         // Показать историю
  | 'usage'           // Как использовать
  | 'related';        // Связанные компоненты
```

---

## Оценка объёма работ

| TASK | Сложность | Приоритет | Статус |
|------|-----------|-----------|--------|
| 49. AI Query Interface | Средняя | Критический | ✅ Завершено |
| 50. AI Metadata Processor | Высокая | Критический | ✅ Завершено |
| 51. Component Context Assistant | Средняя | Высокий | ✅ Завершено |
| 52. Расширенный поиск | Средняя | Средний | ✅ Завершено |
| 53. Интеграция с TinyLLM | Высокая | Критический | ✅ Завершено |

---

## Зависимости

- **Фаза 6** (Developer Experience) — система метаданных и DevMode контекст
- **TinyLLM** — существующий AI-модуль для генерации
- **componentMetaRegistry** — реестр метаданных компонентов

---

## Следующие шаги

После завершения Фазы 8 планируется:

- **Фаза 9**: [GOD MODE — Автоматизация интерактивной разработки](phase-9.md)
  - Единое плавающее окно для DevMode
  - AI-агент для обсуждения улучшений
  - Автоматическое создание GitHub issues
  - Выделение в отдельную библиотеку

---

**Назад к [README](../../README.md)**
